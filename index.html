
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Part Finder</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
</head>
<body>
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Parts Finder - Limitless LLC</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); color: #2d3748; line-height: 1.6; min-height: 100vh; padding: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Header */
        .header { text-align: center; margin-bottom: 30px; padding: 30px 20px; background: linear-gradient(120deg, #2c3e50 0%, #3498db 100%); color: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.15); position: relative; }
        .header h1 { font-size: 2.8rem; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.2rem; opacity: .9; max-width: 700px; margin: 0 auto; }
        .cart-icon-header { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 24px; color: white; display: flex; align-items: center; gap: 8px; }
        .cart-count { background: #e74c3c; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        .core-badge-header { position: absolute; top: 50px; right: 20px; background: #f39c12; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; display: none; }

        /* Search */
        .search-section { background: white; border-radius: 16px; padding: 30px; box-shadow: 0 5px 20px rgba(0,0,0,.08); margin-bottom: 30px; }
        .search-box { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .search-input { flex: 1; min-width: 300px; padding: 18px 22px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; transition: .3s; box-shadow: 0 2px 5px rgba(0,0,0,.05); }
        .search-input:focus { border-color: #3498db; box-shadow: 0 0 0 3px rgba(52,152,219,.2); outline: none; }
        .search-btn { padding: 18px 32px; background: linear-gradient(120deg, #2980b9 0%, #3498db 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; transition: .3s; box-shadow: 0 4px 8px rgba(52,152,219,.3); }
        .search-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(52,152,219,.4); }

        /* Filters */
        .filters { display: flex; gap: 25px; flex-wrap: wrap; margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; }
        .filter-item { display: flex; align-items: center; gap: 10px; }
        .filter-item input { width: 20px; height: 20px; cursor: pointer; }
        .filter-item label { font-weight: 500; cursor: pointer; }

        /* Status */
        .status { padding: 15px 0; color: 4a5568; min-height: 24px; display: flex; align-items: center; gap: 10px; }

        /* Results */
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .result-card { border: 1px solid #e2e8f0; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,.08); transition: .3s; background: white; display: flex; flex-direction: column; position: relative; animation: fadeIn .5s ease-out; }
        .result-card:hover { transform: translateY(-5px); box-shadow: 0 12px 20px rgba(0,0,0,.15); }
        .core-badge { position: absolute; top: 15px; right: 15px; background: #f39c12; color: white; padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: help; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,.2); display: flex; align-items: center; gap: 5px; }
        .card-image { display: flex; align-items: center; justify-content: center; height: 220px; border-bottom: 1px solid #f1f1f1; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .card-image img { max-width: 85%; max-height: 200px; object-fit: contain; }
        .card-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .part-number { font-weight: 700; margin-bottom: 8px; font-size: 18px; color: #2c3e50; }
        .brand-uom { font-size: 14px; color: #718096; margin-bottom: 12px; }
        .description { font-size: 14px; color: #4a5568; margin-bottom: 15px; flex-grow: 1; }
        .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .chip { display: inline-block; padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 500; }
        .chip.price { background: #ebf8ff; color: #2b6cb0; border: 1px solid #bee3f8; }
        .chip.stock { background: #f0fff4; color: #2f855a; border: 1px solid #c6f6d5; }
        .chip.core { background: #fff5f5; color: #c53030; border: 1px solid #fed7d7; }
        .alt-pns { margin-top: 12px; font-size: 13px; color: #718096; }
        .quantity-control { display: flex; align-items: center; margin: 15px 0; gap: 10px; }
        .quantity-label { font-weight: 500; color: #4a5568; }
        .quantity-input { width: 70px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }
        .action-buttons { display: flex; gap: 12px; margin-top: 10px; }
        .action-btn { flex: 1; text-align: center; text-decoration: none; padding: 12px; border-radius: 10px; font-weight: 500; transition: .3s; display: flex; align-items: center; justify-content: center; gap: 8px; border: none; cursor: pointer; }
        .cart-btn { background: #2c3e50; color: white; border: 2px solid #2c3e50; }
        .cart-btn:hover { background: #1a202c; }
        .whatsapp-btn { background: white; color: #25D366; border: 2px solid #25D366; }
        .whatsapp-btn:hover { background: #25D366; color: white; }

        /* Cart */
        .cart-section { margin-top: 40px; padding-top: 30px; border-top: 2px solid #e2e8f0; }
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cart-title { font-size: 26px; color: #2c3e50; font-weight: 600; }
        .cart-toggle { padding: 12px 24px; background: linear-gradient(120deg, #2980b9 0%, #3498db 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: .3s; }
        .cart-toggle:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(52,152,219,.3); }
        .cart-content { display: none; margin-top: 20px; background: white; border-radius: 16px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,.08); }
        .cart-items { margin-bottom: 25px; }
        .cart-item { border: 1px solid #e2e8f0; border-radius: 12px; margin-bottom: 15px; overflow: hidden; }
        .cart-item-main { display: flex; justify-content: space-between; padding: 18px; align-items: center; background: #f8f9fa; cursor: pointer; }
        .cart-item-details { flex: 1; }
        .cart-item-name { font-weight: 600; margin-bottom: 6px; color: #2c3e50; display: flex; align-items: center; gap: 10px; }
        .cart-item-core-badge { background: #f39c12; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; }
        .cart-item-price { color: #718096; font-size: 14px; }
        .cart-item-expand { color: #718096; font-size: 14px; transition: .3s; }
        .cart-item-expand.open { transform: rotate(180deg); }
        .cart-item-core { padding: 15px; background: #fff5f5; border-top: 1px solid #fed7d7; display: none; }
        .cart-item-core-content { display: flex; justify-content: space-between; align-items: center; }
        .cart-item-core-info { flex: 1; }
        .cart-item-core-name { font-weight: 500; margin-bottom: 4px; color: #c53030; }
        .cart-item-core-desc { color: #e53e3e; font-size: 13px; }
        .cart-item-remove { color: #e53e3e; background: none; border: none; cursor: pointer; padding: 8px 16px; font-size: 14px; border-radius: 6px; transition: .3s; }
        .cart-item-remove:hover { background: #fed7d7; }
        .cart-total { font-weight: 700; text-align: right; padding: 20px 0; border-top: 2px solid #e2e8f0; font-size: 20px; color: #2c3e50; }
		
		/* Customer Information Section */
		.customer-info-section { background:#f8f9fa; border-radius:12px; padding:20px; margin-bottom:20px; }
		.customer-info-title { font-size:20px; color:#2c3e50; margin-bottom:15px; padding-bottom:10px; border-bottom:1px solid #e2e8f0; }
		.customer-form { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:15px; }
		.form-group { margin-bottom:15px; }
		.form-label { display:block; margin-bottom:6px; font-weight:500; color:#4a5568; }
		.form-input, .form-textarea, .form-select { width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:16px; transition:border-color .3s; }
		.form-input:focus, .form-textarea:focus, .form-select:focus { border-color:#3498db; outline:none; box-shadow:0 0 0 3px rgba(52,152,219,.2); }
		.form-textarea { min-height:80px; resize:vertical; }
		.form-required::after { content:"*"; color:#e53e3e; margin-left:4px; }
		.form-error { color:#e53e3e; font-size:14px; margin-top:5px; display:none; }
		.invalid { border-color:#e53e3e !important; box-shadow:0 0 0 3px rgba(229,62,62,.15) !important; }

        /* Checkout box */
        .checkout-section { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .checkout-title { font-size: 20px; color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
        .checkout-instructions { margin-bottom: 20px; line-height: 1.5; }
        .payment-method { margin-bottom: 20px; }
        .payment-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .payment-select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 8px; }
        .payment-note { font-size: 14px; color: #4a5568; margin-bottom: 15px; padding: 10px; background: #edf2f7; border-radius: 6px; }
        .shipping-note { font-size: 14px; color: #4a5568; margin-bottom: 10px; }
        .compliance-notes { font-size: 12px; color: #718096; margin-bottom: 20px; }
        .compliance-note { margin-bottom: 5px; }
        .checkout-btn { padding: 18px; background: linear-gradient(120deg, #38a169 0%, #48bb78 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 600; width: 100%; transition: .3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .checkout-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(72,187,120,.3); }
        .checkout-helper { font-size: 12px; color: #718096; text-align: center; margin-top: 10px; }
        .empty-cart { color: #a0aec0; font-style: italic; text-align: center; padding: 40px; font-size: 16px; }

        /* Update Cart Button */
        .update-cart-btn { padding: 12px 20px; background: #2c3e50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; transition: .3s; }
        .update-cart-btn:hover { background: #1a202c; }

        
#lf-inline-cart {
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 10;
}
.search-section {
    position: relative;
}


        /* inline add-to-cart toast on a product card */
        .inline-toast {
          position: absolute;
          top: 12px;
          right: 12px;
          background: #38a169;
          color: #fff;
          padding: 8px 12px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,.15);
          font-size: 14px;
          display: flex;
          align-items: center;
          gap: 8px;
          z-index: 20;
          pointer-events: none; /* don’t block clicks on the card */
        }

        /* Responsive */
        @media (max-width:768px){


        /* Responsive */
		@media (max-width:768px){
		  .header h1{ font-size:2.2rem; }
		  .header p{ font-size:1rem; }
		  .search-box{ flex-direction:column; }
		  .search-input,.search-btn{ width:100%; }
		  .filters{ flex-direction:column; gap:15px; }
		  .results-grid{ grid-template-columns:1fr; }
		  .action-buttons{ flex-direction:column; }
		  .cart-item-main{ flex-direction:column; align-items:flex-start; gap:10px; }
		  .cart-icon-header{ position:relative; top:0; right:0; margin-top:15px; justify-content:center; }
		  .core-badge-header{ position:relative; top:0; right:0; margin:5px auto; width:fit-content; }
		  .customer-form{ grid-template-columns:1fr; }
        }

    /* Animations */
    @keyframes fadeIn{ from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .loading{ display:inline-block; width:20px; height:20px; border:3px solid rgba(255,255,255,.3); border-radius:50%; border-top-color:#fff; animation:spin 1s ease-in-out infinite;}
    @keyframes spin{ to{ transform:rotate(360deg);} }
  
.cart-section{display:none !important;}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1><i class="fas fa-search"></i> Part Finder</h1>
<p>Search our extensive inventory of diesel engine parts</p>
<div class="cart-icon-header" onclick="goCartPage()">
<i class="fas fa-shopping-cart"></i>
<div class="cart-count" id="cart-count">0</div>
</div>
<div class="core-badge-header" id="core-badge-header">
<i class="fas fa-exclamation-circle"></i> Core Items
      </div>
</div>
<div class="search-section">
<div class="search-box">
<input class="search-input" id="lf-input" placeholder="Enter part number, description, or keyword..."/>
<button class="search-btn" id="lf-btn"><i class="fas fa-search"></i> Search</button>
</div>
<div class="filters">
<div class="filter-item"><input checked="" id="lf-exact" type="checkbox"/><label for="lf-exact">Exact Match</label></div>
<div class="filter-item"><input checked="" id="lf-alt" type="checkbox"/><label for="lf-alt">Include Alternate Parts</label></div>
<div class="filter-item"><input id="lf-instock" type="checkbox"/><label for="lf-instock">In Stock Only</label></div>
</div>
<div class="status" id="lf-status"><i class="fas fa-info-circle"></i> Loading parts catalog...</div>
</div>
<div class="results-grid" id="lf-results"></div>
<div class="cart-section">
<div class="cart-header">
</div>
<div class="cart-content" id="cart-content">
<button class="update-cart-btn" onclick="updateCartQuantities()"><i class="fas fa-sync-alt"></i> Update Cart Quantities</button>
<div class="cart-items" id="cart-items">
<div class="empty-cart"><i class="fas fa-shopping-cart"></i><br/> Your cart is empty</div>
</div>
<!-- Customer Information Section -->
<div class="customer-info-section" id="customer-info-section">
<div class="customer-info-title">Customer Information</div>
<div class="customer-form">
<div class="form-group">
<label class="form-label form-required" for="customer-email">Email Address</label>
<input class="form-input" id="customer-email" placeholder="your.email@example.com" type="email"/>
<div class="form-error" id="email-error">Please enter a valid email address</div>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-phone">Phone Number</label>
<input class="form-input" id="customer-phone" placeholder="+1 470 608 3818" type="tel"/>
<div class="form-error" id="phone-error">Please enter a valid phone number</div>
</div>
<div class="form-group">
<label class="form-label" for="customer-company">Company Name</label>
<input class="form-input" id="customer-company" placeholder="Your Company Name" type="text"/>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-name">Full Name</label>
<input class="form-input" id="customer-name" placeholder="First and Last Name" type="text"/>
<div class="form-error" id="name-error">Please enter your name</div>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-address1">Address Line 1</label>
<input class="form-input" id="customer-address1" placeholder="Street address, P.O. box" type="text"/>
<div class="form-error" id="address1-error">Please enter your address</div>
</div>
<div class="form-group">
<label class="form-label" for="customer-address2">Address Line 2</label>
<input class="form-input" id="customer-address2" placeholder="Apartment, suite, unit, building, floor, etc." type="text"/>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-city">City</label>
<input class="form-input" id="customer-city" placeholder="City" type="text"/>
<div class="form-error" id="city-error">Please enter your city</div>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-state">State/Province/Region</label>
<input class="form-input" id="customer-state" placeholder="State / Province / Region" type="text"/>
<div class="form-error" id="state-error">Please enter your state/province</div>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-zip">ZIP/Postal Code</label>
<input class="form-input" id="customer-zip" placeholder="ZIP / Postal code" type="text"/>
<div class="form-error" id="zip-error">Please enter your ZIP/postal code</div>
</div>
<div class="form-group">
<label class="form-label form-required" for="customer-country">Country</label>
<select class="form-select" id="customer-country">
<option value="">Select Country</option>
<option selected="" value="US">United States</option>
<option value="CA">Canada</option>
<option value="MX">Mexico</option>
<option value="AU">Australia</option>
<option value="GB">United Kingdom</option>
<option value="DE">Germany</option>
<option value="FR">France</option>
<option value="OTHER">Other</option>
</select>
<div class="form-error" id="country-error">Please select your country</div>
</div>
<div class="form-group" style="grid-column:1 / -1;">
<label class="form-label" for="customer-instructions">Special Instructions</label>
<textarea class="form-textarea" id="customer-instructions" placeholder="Any special shipping instructions or notes about your order"></textarea>
</div>
</div>
</div>
<div class="checkout-section">
<div class="checkout-title">How Checkout Works</div>
<div class="checkout-instructions">
            The Proceed to Checkout button does not process payment—it sends your order details to Limitless so we can confirm availability, shipping, and send you a secure payment link.
          </div>
<div class="payment-method">
<label class="payment-label" for="payment-method">Choose your preferred payment method:</label>
<select class="payment-select" id="payment-method">
<option value="">Select a payment method</option>
<option value="credit_card">Credit Card (Visa/Mastercard/AmEx)</option>
<option value="paypal">PayPal</option>
<option value="bank_wire">Bank Wire</option>
<option value="zelle">Zelle</option>
<option value="ach">ACH (U.S. only)</option>
</select>
<div class="payment-note" id="payment-note"></div>
</div>
<div class="shipping-note">
<strong>Shipping &amp; Handling:</strong> Calculated after we confirm weight, dimensions, and destination. You'll see the final S&amp;H on our reply email with your payment link.
          </div>
<div class="compliance-notes">
<div class="compliance-note">• Stock &amp; Lead Time: Availability and lead times are confirmed by email before payment.</div>
<div class="compliance-note">• Tax: Sales tax, if applicable, is shown on your final invoice (or buyer may owe use tax).</div>
<div class="compliance-note">• International: Duties and import charges are paid by the consignee unless otherwise agreed.</div>
</div>
<button class="checkout-btn" onclick="checkout()"><i class="fas fa-paper-plane"></i> Proceed to Checkout</button>
<div class="checkout-helper">This will email your order details to Limitless; you'll get a confirmation and payment link.</div>
</div>
<div class="cart-total" id="cart-total">Total: $0.00</div>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js">
</script>
<script>
    function saveCartToStorage() {
      try { localStorage.setItem('lf_cart', JSON.stringify(cart)); } catch(e) {}
    }
    function goCartPage() {
      try { saveCartToStorage(); } catch(e) {}
      window.location.href = 'cart.html';
    }
    
</script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
        (async () => {
            const CSV_URL = "parts_catalog_template.csv";
            const CURRENCY_FALLBACK = "USD";
            const DECIMALS = 2;

            const $in = document.getElementById('lf-input');
            const $go = document.getElementById('lf-btn');
            const $status = document.getElementById('lf-status');
            const $results = document.getElementById('lf-results');
            const $exact = document.getElementById('lf-exact');
            const $alt = document.getElementById('lf-alt');
            const $instock = document.getElementById('lf-instock');

            const $cartContent = document.getElementById('cart-content');
            const $cartItems = document.getElementById('cart-items');
            const $cartTotal = document.getElementById('cart-total');
            const $cartCount = document.getElementById('cart-count');
            const $coreBadgeHeader = document.getElementById('core-badge-header');

            const $paymentMethod = document.getElementById('payment-method');
            const $paymentNote = document.getElementById('payment-note');

			// Customer fields
			const $customerEmail = document.getElementById('customer-email');
			const $customerPhone = document.getElementById('customer-phone');
			const $customerCompany = document.getElementById('customer-company');
			const $customerName = document.getElementById('customer-name');
			const $customerAddress1 = document.getElementById('customer-address1');
			const $customerAddress2 = document.getElementById('customer-address2');
			const $customerCity = document.getElementById('customer-city');
			const $customerState = document.getElementById('customer-state');
			const $customerZip = document.getElementById('customer-zip');
			const $customerCountry = document.getElementById('customer-country');
			const $customerInstructions = document.getElementById('customer-instructions');

            let cart = [];
try {
  const saved = localStorage.getItem('lf_cart');
  if (saved) cart = JSON.parse(saved);
} catch (e) {
  console.error('Could not load cart from storage:', e);
}

    const norm = s => (s || "").toString().toUpperCase().replace(/[\s\-_.]/g, "");
    const fmtMoney = (num, cur) => {
      const n = Number(num);
      if (!isFinite(n)) return String(num || "");
      return `${cur || CURRENCY_FALLBACK} ${n.toFixed(DECIMALS)}`;
    };
    /* FIX #2: Escape helper for status text */
    const esc = s => (s ?? '').toString().replace(/[&<>"']/g, c => (
      ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])
    ));

    // Prefill from localStorage
    (function prefill() {
      try {
        const raw = localStorage.getItem('lf_customer_info');
        if (!raw) return;
        const v = JSON.parse(raw);
        $customerEmail.value = v.email || "";
        $customerPhone.value = v.phone || "";
        $customerCompany.value = v.company || "";
        $customerName.value = v.name || ""
        $customerAddress1.value = v.address1 || "";
        $customerAddress2.value = v.address2 || "";
        $customerCity.value = v.city || "";
        $customerState.value = v.state || "";
        $customerZip.value = v.zip || "";
        $customerCountry.value = v.country || "US";
        $customerInstructions.value = v.instructions || "";
      } catch(e) { /* ignore */ }
    })();

    function saveCustomerInfo() {
      const data = {
        email: $customerEmail.value.trim(),
        phone: $customerPhone.value.trim(),
        company: $customerCompany.value.trim(),
        name: $customerName.value.trim(),
        address1: $customerAddress1.value.trim(),
        address2: $customerAddress2.value.trim(),
        city: $customerCity.value.trim(),
        state: $customerState.value.trim(),
        zip: $customerZip.value.trim(),
        country: $customerCountry.value,
        instructions: $customerInstructions.value.trim()
      };
      localStorage.setItem('lf_customer_info', JSON.stringify(data));
      return data;
    }

    function showError(input, errorEl, show) {
      if (!errorEl) return;
      errorEl.style.display = show ? 'block' : 'none';
      if (show) input.classList.add('invalid'); else input.classList.remove('invalid');
    }

    function validateCustomerInfo() {
      let ok = true;

      const email = $customerEmail.value.trim();
      const phone = $customerPhone.value.trim();
      const name = $customerName.value.trim();
      const address1 = $customerAddress1.value.trim();
      const city = $customerCity.value.trim();
      const state = $customerState.value.trim();
      const zip = $customerZip.value.trim();
      const country = $customerCountry.value;

      // basic patterns
      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const phoneOk = phone.length >= 6; // keep loose for international

      showError($customerEmail, document.getElementById('email-error'), !emailOk);
      showError($customerPhone, document.getElementById('phone-error'), !phoneOk);
      showError($customerName, document.getElementById('name-error'), name === "");
      showError($customerAddress1, document.getElementById('address1-error'), address1 === "");
      showError($customerCity, document.getElementById('city-error'), city === "");
      showError($customerState, document.getElementById('state-error'), state === "");
      showError($customerZip, document.getElementById('zip-error'), zip === "");
      showError($customerCountry, document.getElementById('country-error'), !country);

      ok = emailOk && phoneOk && name && address1 && city && state && zip && country;
      return ok;
    }

            let rows = [];
            try {
                $status.innerHTML = '<i class="fas fa-sync fa-spin"></i> Loading parts catalog...';
                const res = await fetch(CSV_URL, { cache: "no-store" });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const csvText = await res.text();

                let parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true, dynamicTyping: true });
                if (parsed.data.length && Object.keys(parsed.data[0]).length <= 1) {
                    parsed = Papa.parse(csvText, { header: true, delimiter: "\t", skipEmptyLines: true, dynamicTyping: true });
                }

                rows = parsed.data.map(r => {
                    const pn = (r.part_number ?? "").toString().trim();
                    const alt = (r.alt_pns ?? "").toString().split(/[;,]/).map(s => s.trim()).filter(Boolean);
                    return {
                        ...r,
                        __pn: pn,
                        __pn_norm: norm(pn),
                        __alts: alt,
                        __alts_norm: alt.map(norm),
                        __stock_num: Number(r.stock_qty ?? 0),
                        __lead_num: Number(r.lead_days ?? 0),
                        __price_num: Number(r.price ?? NaN),
                        __core_num: Number(r.core_charge ?? 0),
                        currency: r.currency || CURRENCY_FALLBACK
                    };
                }).filter(x => x.__pn);

                if (!rows.length) { 
                    $status.innerHTML = '<i class="fas fa-exclamation-circle"></i> No parts found in catalog. Please check your data source.'; 
                    return; 
                }
                $status.innerHTML = '<i class="fas fa-check-circle"></i> Catalog loaded with ' + rows.length.toLocaleString() + ' parts. Start searching above.';
            } catch (e) {
                console.error("Catalog fetch error:", e);
                $status.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Couldn\'t load catalog: ' + (e.message || e) + '. Please check your CSV URL.';
                return;
            }

            const fuse = new Fuse(rows, {
                includeScore: true,
                threshold: 0.3,
                keys: [
                    { name: "__pn", weight: 0.7 },
                    { name: "alt_pns", weight: 0.3 },
                    { name: "description", weight: 0.2 }
                ]
            });

            function renderCard(r) {
                const img = r.image_url 
                    ? `<div class="card-image"><img src="${r.image_url}" alt="${r.__pn}"></div>`
                    : `<div class="card-image" style="color:#888;font-size:14px;">
                           <i class="fas fa-image" style="font-size:48px;opacity:.3;"></i><br>No Image Available
                       </div>`;

                const price = fmtMoney(r.__price_num, r.currency);
                const stockStatus = (r.__stock_num > 0) ? "In Stock" : (r.__lead_num > 0 ? `Lead ${r.__lead_num}d` : "Call for Availability");
                const stockClass = (r.__stock_num > 0) ? "stock" : "core";
                const alt = (r.alt_pns || "").toString().split(/[;,]/).map(s=>s.trim()).filter(Boolean);
                const alts = alt.length ? `<div class="alt-pns"><strong>Alternate Part Numbers:</strong> ${alt.join(", ")}</div>` : "";
                const inCart = cart.some(item => item.__pn_norm === r.__pn_norm);
const cartButtonText = inCart ? "Go to Cart" : "Add to Cart";
const cartButtonIcon = inCart ? "fa-shopping-cart" : "fa-cart-plus";
const cartButtonAction = inCart
    ? `onclick="goCartPage()"`
    : `onclick="addToCart('${r.__pn_norm}')"`

                const coreBadge = r.__core_num > 0 ? `
                    <div class="core-badge" title="Core Charge: ${fmtMoney(r.__core_num, r.currency)}. Refunded upon return of the used part per supplier policy.">
                        <i class="fas fa-exclamation-circle"></i> Core
                    </div>` : '';

                return `
                <div class="result-card" id="card-${r.__pn_norm}">
                    ${coreBadge}
                    ${img}
                    <div class="card-content">
                        <div class="part-number">${r.__pn}</div>
                        <div class="brand-uom">${r.brand || "No brand"} • ${r.uom || "Unit"}</div>
                        <div class="description">${r.description || "No description available"}</div>
                        <div class="chips">
                            <span class="chip price">${price}</span>
                            <span class="chip ${stockClass}">${stockStatus}</span>
                            ${r.__core_num > 0 ? `<span class="chip core">Core ${fmtMoney(r.__core_num, r.currency)}</span>` : ""}
                        </div>
                        ${alts}
                        <div class="quantity-control">
                            <span class="quantity-label">Qty:</span>
                            <input type="number" min="1" value="1" class="quantity-input" id="qty-${r.__pn_norm}">
                        </div>
                        <div class="action-buttons">
                            <button ${cartButtonAction} class="action-btn cart-btn">
    <i class="fas ${cartButtonIcon}"></i> ${cartButtonText}
</button>

                            <a href="https://wa.me/14706083818?text=${encodeURIComponent('I want to order ' + r.__pn)}" class="action-btn whatsapp-btn" target="_blank" rel="noopener">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </a>
                        </div>
                    </div>
                </div>`;
            }

            function searchAndRender(query) {
    const q = (query || "").trim();
    $results.innerHTML = "";
    if (q.length < 2) { 
        $status.innerHTML = '<i class="fas fa-info-circle"></i> Please type at least 2 characters to search.'; 
        return; 
    }

    const qNorm = norm(q); // e.g., "4955354"
    let matches = [];

    // Helpers
    const uniqByPn = (arr) => {
        const seen = new Set();
        const out = [];
        for (const r of arr) {
            if (!seen.has(r.__pn_norm)) {
                seen.add(r.__pn_norm);
                out.push(r);
            }
        }
        return out;
    };
    const maybeFilterInStock = (arr) => $instock.checked ? arr.filter(r => r.__stock_num > 0) : arr;

    // Precompute sets
    const exactEq = rows.filter(r => r.__pn_norm === qNorm); // full equality
    const pnSuffix = rows.filter(r => r.__pn_norm.endsWith(qNorm)); // ends-with match
    const altSuffix = $alt.checked
        ? rows.filter(r => r.__alts_norm && r.__alts_norm.some(a => a.endsWith(qNorm)))
        : [];

    const fuzzy = fuse.search(q).map(x => x.item);

    if ($exact.checked) {
        // Exact mode now means "exact OR suffix-exact" (PN ends with query),
        // plus suffix matches in alternate numbers if Include Alt is on.
        // Order: exact equality first, then PN suffix, then ALT suffix.
        const ordered = uniqByPn([...exactEq, ...pnSuffix, ...altSuffix]);

        let out = maybeFilterInStock(ordered);
        if (!out.length) {
            $status.innerHTML = '<i class="fas fa-search"></i> No exact or suffix matches found. Try turning off "Exact Match" or adjust your query.';
            return;
        }

        // Status text
        const exactCount = exactEq.length;
        const suffixCount = out.length - exactCount;
        const partsWord = out.length === 1 ? "part" : "parts";
        $status.innerHTML = `<i class="fas fa-check-circle"></i> Found ${out.length} ${partsWord} for "${q}" (${exactCount} exact, ${suffixCount} suffix)`;
        $results.innerHTML = out.map(renderCard).join("");
        return;
    }

    // Non-exact mode (original behavior): fuzzy first, then exact and alts, de-duped
    const combined = uniqByPn([...fuzzy, ...exactEq, ...pnSuffix, ...altSuffix]);
    const out = maybeFilterInStock(combined);

    if (!out.length) { 
        $status.innerHTML = '<i class="fas fa-search"></i> No matching parts found. Try a different part number or adjust your filters.'; 
        return; 
    }

    $status.innerHTML = `<i class="fas fa-search"></i> Found ${out.length} part(s) matching "${q}"`;
    $results.innerHTML = out.map(renderCard).join("");
}

            // Expose some functions to window for onclick handlers
            window.addToCart = function(partNorm) {
                if (cart.some(cartItem => cartItem.__pn_norm === partNorm)) {
                    alert('This item is already in your cart.');
                    return;
                }
                const item = rows.find(r => r.__pn_norm === partNorm);
                if (!item) return;
                const quantity = parseInt(document.getElementById(`qty-${partNorm}`).value) || 1;

                cart.push({
                    ...item,
                    quantity,
                    totalPrice: (Number(item.__price_num) || 0) * quantity,
                    coreIncluded: (Number(item.__core_num) || 0) > 0
                });

                updateCart();
                searchAndRender($in.value);

// Update the button to "Go to Cart"
const btn = document.querySelector(`button[onclick="addToCart('${partNorm}')"]`);
if (btn) {
    btn.innerHTML = '<i class="fas fa-shopping-cart"></i> Go to Cart';
    btn.disabled = false;
    btn.style.opacity = "1";
    btn.onclick = function() {
        goCartPage();
};
}


                // Success toast anchored to the product card
const card = document.getElementById(`card-${partNorm}`);
if (card) {
  // make the card a positioning context
  if (getComputedStyle(card).position === 'static') {
    card.style.position = 'relative';
  }

  const note = document.createElement('div');
  note.className = 'inline-toast';
  note.innerHTML = `<i class="fas fa-check-circle"></i> Added to cart`;
  card.appendChild(note);

  // ensure user sees it even if the card is partly off screen
  card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

  setTimeout(() => note.remove(), 2000);
}

            };

            window.removeFromCart = function(partNorm) {
                cart = cart.filter(item => item.__pn_norm !== partNorm);
                updateCart();
            };

            window.toggleCartItemCore = function(id) {
                const el = document.getElementById(id);
                if (!el) return;
                const section = el.closest('.cart-item').querySelector('.cart-item-core');
                const icon = el.querySelector('i');
                const open = section.style.display === 'block';
                section.style.display = open ? 'none' : 'block';
                icon.classList.toggle('open', !open);
            };

            window.toggleCart = function() {
                const isOpen = $cartContent.style.display === 'block';
                $cartContent.style.display = isOpen ? 'none' : 'block';
                const btn = document.querySelector('.cart-toggle');
                btn.innerHTML = isOpen ? '<i class="fas fa-eye"></i> Show Cart' : '<i class="fas fa-eye-slash"></i> Hide Cart';
            };

            window.updateCartQuantities = function() {
                const qtyInputs = document.querySelectorAll('.cart-qty-input');
                qtyInputs.forEach(inp => {
                    const normId = inp.dataset.norm;
                    const qty = Math.max(1, parseInt(inp.value) || 1);
                    const idx = cart.findIndex(x => x.__pn_norm === normId);
                    if (idx >= 0) {
                        cart[idx].quantity = qty;
                        cart[idx].totalPrice = (Number(cart[idx].__price_num) || 0) * qty;
                    }
                });
                updateCart();
            };

            function updateCart() {
                if (!cart.length) {
                    $cartItems.innerHTML = `<div class="empty-cart"><i class="fas fa-shopping-cart"></i><br> Your cart is empty</div>`;
                    $cartTotal.textContent = 'Total: $0.00';
                    $cartCount.textContent = '0';
                    $coreBadgeHeader.style.display = 'none';
                    return;
                }

                let subtotal = 0;
                let coreTotal = 0;
                const itemsHtml = cart.map(item => {
                    const line = (Number(item.__price_num) || 0) * item.quantity;
                    subtotal += line;
                    if (Number(item.__core_num) > 0) coreTotal += Number(item.__core_num) * item.quantity;

                    const hasCore = Number(item.__core_num) > 0;
                    const coreRow = hasCore ? `
                        <div class="cart-item-core">
                            <div class="cart-item-core-content">
                                <div class="cart-item-core-info">
                                    <div class="cart-item-core-name">Core Charge</div>
                                    <div class="cart-item-core-desc">Core charges are refundable upon return of the used part per supplier policy.</div>
                                </div>
                                <div><strong>${fmtMoney(item.__core_num, item.currency)}</strong> x ${item.quantity}</div>
                            </div>
                        </div>` : '';

                    return `
                    <div class="cart-item">
                        <div class="cart-item-main" onclick="toggleCartItemCore('exp-${item.__pn_norm}')">
                            <div class="cart-item-details">
                                <div class="cart-item-name">
                                    ${item.__pn}
                                    ${hasCore ? '<span class="cart-item-core-badge">Core</span>' : ''}
                                </div>
                                <div class="cart-item-price">${fmtMoney(item.__price_num, item.currency)} x 
                                    <input type="number" min="1" value="${item.quantity}" class="quantity-input cart-qty-input" data-norm="${item.__pn_norm}" style="width:70px; margin-left:6px;">
                                </div>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <div><strong>${fmtMoney(line, item.currency)}</strong></div>
                                ${hasCore ? `<div id="exp-${item.__pn_norm}" class="cart-item-expand"><i class="fas fa-chevron-down"></i></div>` : ''}
                                <button class="cart-item-remove" onclick="event.stopPropagation(); removeFromCart('${item.__pn_norm}')"><i class="fas fa-trash-alt"></i> Remove</button>
                            </div>
                        </div>
                        ${coreRow}
                    </div>`;
                }).join("");

                const estTotal = subtotal + coreTotal;
                $cartItems.innerHTML = itemsHtml;
                $cartTotal.innerHTML = `
                    <div><span style="opacity:.8;">Subtotal:</span> ${fmtMoney(subtotal)}</div>
                    <div><span style="opacity:.8;">Core Charges:</span> ${fmtMoney(coreTotal)}</div>
                    <div style="margin-top:6px;">Est. Total: <strong>${fmtMoney(estTotal)}</strong></div>`;
                $cartCount.textContent = String(cart.reduce((a, b) => a + (b.quantity || 0), 0));
                $coreBadgeHeader.style.display = cart.some(x => Number(x.__core_num) > 0) ? 'inline-block' : 'none';
            }

			// Payment notes (FIX #4: use $0.30 instead of colón symbol)
			function updatePaymentNote() {
			  const v = $paymentMethod.value;
			  let text = '';
			  if (v === 'credit_card') text = 'Card payments incur +3.5% + $0.30 processing. You’ll receive a secure payment link.';
			  else if (v === 'paypal') text = 'PayPal payments incur +3.9% + $0.30 processing. We’ll send a PayPal link.';
			  else if (v === 'bank_wire') text = 'Bank wire transfers incur a $25 bank fee. We’ll email you our banking details.';
			  else if (v === 'zelle') text = 'No processing fee. We’ll email the Zelle instructions.';
			  else if (v === 'ach') text = 'No processing fee. We’ll email the ACH instructions.';
			  $paymentNote.textContent = text;
            }
            $paymentMethod.addEventListener('change', updatePaymentNote);

    // Checkout via mailto (includes customer info)
    window.checkout = function() {
      if (!cart.length) {
        alert('Your cart is empty.');
        return;
      }
      const pay = $paymentMethod.value;
      if (!pay) {
        alert('Please select a payment method.');
        return;
      }
      if (!validateCustomerInfo()) {
        alert('Please correct the highlighted customer fields.');
        return;
      }
      const cust = saveCustomerInfo(); // persist

      const payMap = {
        credit_card: 'Credit Card (+3.5% + $0.30)',
        paypal: 'PayPal (+3.9% + $0.30)',
        bank_wire: 'Bank Wire (+$25)',
        zelle: 'Zelle (+$0.0)',
        ach: 'ACH (+$0.0)'
      };

      let lines = cart.map(it => {
        const price = fmtMoney(it.__price_num, it.currency);
        const core = Number(it.__core_num) > 0 ? ` | Core: ${fmtMoney(it.__core_num, it.currency)} x ${it.quantity}` : '';
        return `• ${it.__pn} | Qty: ${it.quantity} | Unit: ${price}${core}`;
      }).join('%0A');

      let subtotal = cart.reduce((s, it) => s + (Number(it.__price_num)||0) * it.quantity, 0);
      let cores = cart.reduce((s, it) => s + (Number(it.__core_num)||0) * it.quantity, 0);
      const estTotal = subtotal + cores;

      const subject = encodeURIComponent('New Parts Order Request - Limitless Website');
      const customerBlock =
`Customer Details:
• Name: ${cust.name}
• Company: ${cust.company || '-'}
• Email: ${cust.email}
• Phone: ${cust.phone}

Ship-To:
• ${cust.address1}${cust.address2 ? ', ' + cust.address2 : ''}
• ${cust.city}, ${cust.state} ${cust.zip}
• ${cust.country}

Notes:
${cust.instructions || '-'}`;

      const body = encodeURIComponent(
`Customer indicates they are ready to order.

Items:
${decodeURIComponent(lines)}

Subtotal: ${fmtMoney(subtotal)}
Core Charges: ${fmtMoney(cores)}
Est. Total: ${fmtMoney(estTotal)}

Selected Payment Method: ${payMap[pay]}

${customerBlock}

- Shipping & Handling will be calculated based on final weight, dimensions, and destination.
- Please confirm availability and lead time before sending payment link.

(Automatically generated from Find Parts page)`
      );

      const toast = document.createElement('div');
      toast.style.cssText = `
        position:fixed; bottom:20px; right:20px; background:#3182ce; color:#fff;
        padding:12px 16px; border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,.2); z-index:1000;`;
      toast.innerHTML = `<i class="fas fa-envelope"></i> Preparing email…`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2500);

      window.parent.location.href = `mailto:info@limitless-llc.us?subject=${subject}&body=${body}`;
    };

    // Listeners
    $go.addEventListener('click', () => searchAndRender($in.value));
    $in.addEventListener('keydown', (e) => { if (e.key === 'Enter') searchAndRender($in.value); });
    [$exact, $alt, $instock].forEach(el => el.addEventListener('change', () => searchAndRender($in.value)));

    // Initial hint (FIX #5: only show if we did not already display "loaded")
    if (!$status.dataset.loaded) {
      $status.innerHTML = '<i class="fas fa-info-circle"></i> Type a part number (e.g., 3802010) or keyword to begin.';
    }
  })();
  // Scroll to cart when header cart icon is clicked
window.toggleCartAndScroll = function() {
    toggleCart(); // toggles cart visibility
    setTimeout(() => {
        const cartSection = document.getElementById('cart-content');
        if (cartSection && cartSection.style.display === 'block') {
            cartSection.scrollIntoView({ behavior: 'smooth' });
        }
    }, 150); // delay allows cart to open before scrolling
}; 
  </script>
</body>
</html>
</body>
</html>
